import post from '../../templates/post'

export const meta = {
  title: 'For switch',
  author: 'yutsun',
  date: '2020-04-15',
  description: 'summary'
}

export default post(meta)

<!-- content starts here -->
问题是什么
子问题是什么
问题解决方案有哪些（线程池、限流算法、拒绝）

#### 问题背景

使用vm工具检测pim后端数据分析进程观察到cpu占用率偶有飙升现象，频率约为五分钟一次，跟数据采集频率一致，dump
线程快照分析确认是数据分析到告警处理段占用了大部分cpu时间，为了

我们知道，分布式系统的高可用离不开限流、降级、熔断这三种手段。
限流的目的是降低大量请求对服务的压力，使服务在合理的负载下运行，保持可用性。
常见的限流算法有计数器、漏桶和令牌三种，下面逐个介绍一下。

##### 计数器

计数器算法是把时间分割成区间，在区间的头部初始化单位时间内请求的数量的上限，超出上限的请求执行限流策略。
这个方法比较直观，但假如请求集中在区间头或者区间尾，这个方法可能就不那么有效。当然这个问题可以通过细化时间
区间粒度的方式来解决。

##### 漏桶（Leaky Bucket）

漏桶算法假设有一个固定容量的请求桶，所有请求先进入桶中，超出桶容量的请求会被丢弃，同时桶以固定的速率
释放请求--即漏水。
以上是漏洞算法的一种常见描述，其中的桶实质上是一个队列，请求会以平稳的速度被接受，不会有波动。

漏桶算法的另一个描述是，当请求到来时，我们先去查看桶是否是满的，如果未满，请求就被接受，并往桶中加水，
桶里的水依然以固定速率漏出。

wiki上称第一种“as a queue”--作为队列，第二种“as a meter”--作为计价器，很形象。


##### 令牌桶（Token Bucket）

令牌桶算法假设有一个令牌桶，我们以一个频率生成令牌，将令牌放入桶中，请求先要从桶中取出令牌才能被响应，若
令牌桶为空，则执行限流策略。

不难看出，令牌桶和计价器漏桶实质上是等同的。

#### 限流策略

限流策略主要分两种，请求丢弃或者等待。

