import post from '../../templates/post'
import app from '../../templates/post'

export const meta = {
  title: '监考告警性能优化',
  author: 'yutsun',
  date: '2020-06-08',
  description: 'summary'
}

export default post(meta)

<!-- content starts here -->

最近在对告警模块进行优化，这件事越做越能感受到目前项目中的不合理性和局限性，暂且记录一下自己的想法。

### 告警模块的核心目标

告警模块的核心目标有两个，可靠和灵活。功能上可靠，拓展上灵活，以下分开阐述理由。

#### 可靠

可靠意味着监考平台可以在第一时间获取告警，信息充分，无遗漏。
在数据中心的运维工作中，处理硬件故障是重中之重，理想状态下的告警信息应该涵盖处理硬件故障所需的全部信息，比方说位置、传感器、具体读数.etc.
然而在实际状态下，用户接到告警后，往往还需要到bmc中对日志进行排查才能定位故障点，又或者在bmc里也无法找到对应的日志。
这里的原因有两个，一是信息丢失，二是告警原始信息不可追溯。

1. 信息丢失

trap信息本身也基本可以满足需求，然而由于解析过程多变，trap转换成告警后，会丢失部分信息。这个问题的解决有赖于一套合理的trap解析方案，合理的trap解决
方案有赖于完善的mib解析工具，各厂家的mib文件本身又不是那么的标准。。。嗯，此处有坑需要填。

另外，基于规则的告警也会被规则所限。指定规则的人并不一定懂硬件，因此规则本身也未必科学，对扭曲的规则进行修正，单是想一想其中的乏味无趣，就足以使人却步。
要是能利用机器学习，匹配一个归类模型出来，那可真是太棒了。

2. 原始信息追溯

最怕客户问到的问题之一就是“你们为啥报了不在位？明明在位，bmc里也没异常，是误报吧？”，真的头疼，我知道这个是抓取传感器原始数据得来的，但是这部分数据没有
保留，说服力不够。trap也是一样，保留原始trap信息，有助于定位问题，不管是硬件问题，还是告警模块解析问题。raw data可追溯确保了监控平台数据的权威性。

#### 灵活

可靠是面向用户而言，灵活更多的是开发层面上的要求。告警模块需要支持多来源多协议告警，只要按照对应的格式封装，就应该支持。

对告警而言，较有价值的附加功能有查询、状态标记、合并、通知、统计。

我认为告警核心功能只应保留必要的告警信息，并持久化，附加功能都应独立于核心流程。显而易见的好处是提高告警吞吐量，原始信息可追溯。
查询、通知和统计这些功能独立出来没人有意见，状态标记和合并肯定会有争议，我看不到将他们独立出来的坏处--除了定时整理数据之外，就只需要专心优化查询了，还有比
这更棒的事情吗？
